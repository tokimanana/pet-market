services:
  # Backend NestJS
  - type: web
    name: pet-market-ko
    env: node
    region: frankfurt
    plan: free
    buildCommand: NODE_ENV=development npm install && npx prisma generate && npx nx build pet-market-ko --configuration=production
    startCommand: node apps/pet-market-ko/dist/main.js
    envVars:
      - key: DATABASE_URL
        sync: false
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 10000
      - key: STRIPE_SECRET_KEY
        sync: false
      - key: FRONTEND_URL
        value: https://pet-market-web-a61t.onrender.com
    buildFilter:
      paths:
        # Backend spécifique
        - apps/pet-market-ko/**
        - prisma/**
        # Dépendances partagées
        - package.json
        - package-lock.json
        - nx.json
        - tsconfig.base.json
      ignoredPaths:
        # Ignorer les fichiers non-critiques
        - "**/*.md"
        - "**/*.test.ts"
        - "**/*.spec.ts"
        - "**/README.md"

  # Frontend Angular
  - type: web
    name: pet-market-web
    env: node
    region: frankfurt
    plan: free
    buildCommand: NODE_ENV=development npm install && npx nx build pet-market-web --configuration=production
    startCommand: node dist/apps/pet-market-web/server/server.mjs
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 10000
      - key: API_URL
        value: https://pet-market-ko.onrender.com/graphql
    buildFilter:
      paths:
        # Frontend spécifique
        - apps/pet-market-web/**
        # Dépendances partagées
        - package.json
        - package-lock.json
        - nx.json
        - tsconfig.base.json
      ignoredPaths:
        - "**/*.md"
        - "**/*.test.ts"
        - "**/*.spec.ts"
        - "**/README.md"